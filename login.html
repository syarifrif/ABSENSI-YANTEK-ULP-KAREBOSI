<script>
const API_URL = "PASTE_URL_EXEC_KAMU"; // <-- pastikan /exec

document.getElementById('btnLogin').onclick = async ()=>{
  const nip = document.getElementById('nip').value.trim();
  const pin = document.getElementById('pin').value.trim();
  const msg = document.getElementById('msg'); msg.textContent='';

  if(!nip){ msg.textContent='NIP wajib diisi'; return; }

  try{
    const url = `${API_URL}?action=auth&nip=${encodeURIComponent(nip)}&pin=${encodeURIComponent(pin)}`;
    const res = await fetch(url, {method:'GET', redirect:'follow'});

    const text = await res.text(); // ambil teks mentah untuk debug
    let j;
    try { j = JSON.parse(text); }
    catch (e) {
      // Tampilkan potongan respon agar tahu masalahnya
      msg.textContent = 'Respon bukan JSON dari server: ' + text.slice(0,180);
      return;
    }

    if(!j.ok){ msg.textContent = j.message || 'Gagal login'; return; }

    sessionStorage.setItem('abs_nip', j.nip);
    sessionStorage.setItem('abs_nama', j.nama);
    sessionStorage.setItem('abs_role', j.role || 'user');
    location.href = 'app.html';
  }catch(e){
    msg.textContent = 'Tidak bisa menghubungi server: ' + (e.message || e);
  }
};
</script>
