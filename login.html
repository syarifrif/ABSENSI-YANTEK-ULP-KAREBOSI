<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login â€¢ Absensi YANTEK ULP Karebosi</title>
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
</head>
<body class="page">
  <div class="card">
    <h1>Login</h1>
    <label>NIP</label>
    <input id="nip" placeholder="7232XXXXMKS" autocomplete="off">
    <label>PIN</label>
    <input id="pin" placeholder="Sesuai kolom PIN" type="password">
    <button id="btn">Masuk</button>
    <div id="msg" class="msg"></div>
  </div>

<script>
const $ = s => document.querySelector(s);
$('#btn').onclick = async () => {
  const nip = $('#nip').value.trim().toUpperCase();
  const pin = $('#pin').value.trim();
  $('#msg').textContent = 'Memeriksa...';
  try {
    const url = `${window.API_URL}?action=auth&nip=${encodeURIComponent(nip)}&pin=${encodeURIComponent(pin)}`;
    const r = await fetch(url);
    const j = await r.json();
    if (j.ok) {
      localStorage.setItem('auth', JSON.stringify({ nip, pin, nama: j.nama, role: j.role }));
      location.href = 'app.html';
    } else {
      $('#msg').textContent = j.message || 'Gagal login';
    }
  } catch (e) {
    $('#msg').textContent = 'Tidak bisa menghubungi server';
  }
};
</script>
</body>
</html>
